<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Sales — Apple Style</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <style>
        :root { --bg: #f5f5f7; --text: #1d1d1f; --accent: #0071e3; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; }
        .container { max-width: 1400px; margin: 20px auto; }
        .back-link { color: var(--accent); text-decoration: none; font-weight: 500; display: inline-block; margin-bottom: 20px; }
        h1 { font-size: 32px; font-weight: 600; margin-bottom: 20px; letter-spacing: -0.5px; }
        
        .table-card { 
            background: white; 
            border-radius: 22px; 
            box-shadow: 0 8px 30px rgba(0,0,0,0.04); 
            overflow-x: auto; 
        }

        table { width: 100%; border-collapse: collapse; min-width: 1000px; }
        th { text-align: left; padding: 16px; color: #86868b; font-size: 11px; font-weight: 600; text-transform: uppercase; border-bottom: 1px solid #d2d2d7; background: white; }
        td { padding: 16px; border-bottom: 1px solid #f5f5f7; font-size: 14px; white-space: nowrap; }
        
        /* ФІКСОВАНА КОЛОНКА ПІБ */
        .name-cell, th:first-child { 
            position: sticky; 
            left: 0; 
            background: white; 
            z-index: 10; 
            min-width: 180px; 
            box-shadow: 4px 0 8px -4px rgba(0,0,0,0.1);
        }
        th:first-child { z-index: 11; }

        /* КОЛЬОРИ СТОВПЦІВ */
        .col-to { color: #0071e3; font-weight: 600; }
        .col-poslugi { color: #af52de; font-weight: 600; }
        .col-acc { color: #ff9500; font-weight: 600; }
        .col-cheky { color: #34c759; font-weight: 600; }

        /* СТРОКА З ЧАСОМ */
        .time-row { background: #f5f5f7 !important; font-weight: 800 !important; }
        .time-row td { color: #000; }
        .time-row .name-cell { background: #f5f5f7 !important; }

        .loading { padding: 40px; text-align: center; color: #86868b; }

        /* МОБІЛЬНА ВЕРСІЯ: ЗМЕНШЕННЯ ШРИФТУ ПІБ */
        @media (max-width: 600px) {
            .name-cell, th:first-child { 
                min-width: 80px; 
                max-width: 80px;
                padding: 10px 5px;
                font-size: 10px; /* Дуже дрібний шрифт для ПІБ */
                white-space: normal; /* Дозволяємо перенос тексту, щоб влізло у вузьку колонку */
                line-height: 1.1;
                text-align: center;
            }
            
            /* Робимо цифри трохи компактнішими */
            td:not(.name-cell) {
                padding: 12px 8px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Назад</a>
        <h1>Щоденні звіти</h1>
        <div class="table-card">
            <div id="loader" class="loading">Завантаження даних з Google Sheets...</div>
            <table id="dataTable" style="display: none;">
                <thead><tr id="headerRow"></tr></thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>
    <script>
        // Парсер CSV (той самий що в plan-fact.html)
        function parseCSV(text) {
            const rows = []; let row = []; let col = ""; let inQuotes = false;
            for (let i = 0; i < text.length; i++) {
                let char = text[i];
                if (char === '"' && text[i+1] === '"') { col += '"'; i++; }
                else if (char === '"') { inQuotes = !inQuotes; }
                else if (char === ',' && !inQuotes) { row.push(col); col = ""; }
                else if (char === '\n' && !inQuotes) { row.push(col); rows.push(row); row = []; col = ""; }
                else { col += char; }
            }
            if (col || row.length) { row.push(col); rows.push(row); }
            return rows;
        }

        // Очищення значення
        function cleanVal(val) {
            if (!val) return "";
            return val.toString().trim();
        }

        async function loadTable() {
            // URL вашої Google таблиці для daily sales
            // ЗАМІНІТЬ на правильний URL вашої таблиці для щоденних звітів!
            const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQOxz-ozH9yNLW3IAzlkMlbRqOTrR4sIUO1__KpAMBFEvvpMXr4LWTnRvzYGb_y6za7WBxOUhl2DV84/pub?output=csv";
            
            try {
                const response = await fetch(SHEET_URL + '&t=' + Date.now());
                const text = await response.text();
                const rows = parseCSV(text);

                if (!rows || rows.length < 2) {
                    document.getElementById('loader').textContent = "Немає даних";
                    return;
                }

                // Приховуємо loader, показуємо таблицю
                document.getElementById('loader').style.display = 'none';
                document.getElementById('dataTable').style.display = 'table';

                // Отримуємо заголовки (перший рядок)
                const headers = rows[0];
                const hRow = document.getElementById('headerRow');
                
                headers.forEach(h => {
                    let th = document.createElement('th');
                    th.textContent = h;
                    hRow.appendChild(th);
                });

                // Заповнюємо дані (всі рядки крім першого)
                const tbody = document.getElementById('tableBody');
                const dataRows = rows.slice(1);

                dataRows.forEach(row => {
                    // Пропускаємо порожні рядки
                    if (!row || row.length === 0 || !row[0]) return;

                    let tr = document.createElement('tr');
                    const nameVal = cleanVal(row[0]);
                    
                    // Якщо в першій колонці час (формат HH:MM:SS) - це строка з часом
                    if (nameVal.match(/^\d{2}:\d{2}:\d{2}$/)) {
                        tr.className = 'time-row';
                    }

                    headers.forEach((h, index) => {
                        let td = document.createElement('td');
                        let val = cleanVal(row[index]);
                        
                        if (index === 0) {
                            // Перша колонка - ПІБ або час
                            td.className = 'name-cell';
                            td.textContent = val;
                        } else {
                            // Інші колонки - числа
                            td.textContent = val;
                            
                            // Застосовуємо кольори в залежності від назви колонки
                            const hName = h.toUpperCase();
                            if (hName === 'ТО') {
                                td.classList.add('col-to');
                            } else if (hName.includes('ПОСЛУГИ') || hName.includes('ПОСЛУГ')) {
                                td.classList.add('col-poslugi');
                            } else if (hName === 'АСС' || hName.includes('АКСЕС')) {
                                td.classList.add('col-acc');
                            } else if (hName === 'ЧЕКИ' || hName.includes('ЧЕК')) {
                                td.classList.add('col-cheky');
                            }
                        }
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });

            } catch (e) {
                document.getElementById('loader').textContent = "Помилка завантаження: " + e.message;
                console.error("Помилка:", e);
            }
        }

        // Завантажуємо дані при відкритті сторінки
        loadTable();

        // СВАЙП-НАВІГАЦІЯ
        let touchStartX = 0;
        let touchStartY = 0;
        let touchEndX = 0;
        let touchEndY = 0;
        let isSwiping = false;
        
        function handleSwipe() {
            const swipeThreshold = 120; // Збільшено поріг
            const swipeDistanceX = touchEndX - touchStartX;
            const swipeDistanceY = Math.abs(touchEndY - touchStartY);
            
            // Свайп тільки якщо чіткий горизонтальний рух
            if (isSwiping && Math.abs(swipeDistanceX) > swipeThreshold && swipeDistanceX > 0 && swipeDistanceY < 50) {
                // Свайп вправо - повернутися на головну
                window.location.href = 'index.html';
            }
        }
        
        document.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
            isSwiping = true;
        }, { passive: true });
        
        document.addEventListener('touchmove', e => {
            const moveY = Math.abs(e.changedTouches[0].screenY - touchStartY);
            const moveX = Math.abs(e.changedTouches[0].screenX - touchStartX);
            // Якщо більше вертикальний рух - це не свайп
            if (moveY > 20 || moveX < 30) {
                isSwiping = false;
            }
        }, { passive: true });
        
        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            touchEndY = e.changedTouches[0].screenY;
            handleSwipe();
            isSwiping = false;
        }, { passive: true });
    </script>
</body>
</html>
